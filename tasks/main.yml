---
- include: compat.yml

- include: include_vars.yml

- name: download docker key
  command: >
    gpg --keyserver p80.pool.sks-keyservers.net
    --recv 58118E89F3A912897C070ADBF76221572C52609D
  register: docker_key_result
  changed_when: "{{'unchanged: 1' not in docker_key_result.stderr}}"
  sudo: yes

- name: write docker key to /root
  command: >
    gpg --output /root/docker.gpg
        --export 58118E89F3A912897C070ADBF76221572C52609D
  args:
    creates: /root/docker.gpg
  sudo: yes

- include: Debian.yml
  when: ansible_os_family == 'Debian'

- include: RedHat.yml
  when: ansible_os_family == 'RedHat'

- include: install_package_names.yml

- name: add docker group to users
  user: name={{ item }} groups=docker append=yes
  with_items: '{{docker_users}}'
  sudo: yes
